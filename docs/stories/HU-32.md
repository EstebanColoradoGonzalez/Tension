# HU-32 — Importar respaldo de datos

## Requisitos relacionados

RNF16, RNF17, RNF18

## Descripción

Como ejecutante, quiero poder importar un respaldo previamente exportado para restaurar mis datos completos, para recuperar mi historial tras un cambio de dispositivo, reinstalación de la app o pérdida de datos, sin perder meses de progresión registrada.

## Criterios de Aceptación

### CA-32.01 — Selección del archivo de backup

**Dado que** el ejecutante desea restaurar sus datos,
**cuando** accede a la funcionalidad de importación de respaldo,
**entonces** el sistema permite seleccionar un archivo de backup previamente exportado desde el almacenamiento del dispositivo o desde una aplicación del sistema (Drive, correo, etc.).

### CA-32.02 — Validación del archivo de backup

**Dado que** el ejecutante selecciona un archivo para importar,
**cuando** el sistema lee el archivo,
**entonces** valida que el formato sea autodescriptivo y contenga los metadatos de versión esperados; si el archivo no es válido o está corrupto, informa al ejecutante con un mensaje de error claro y no procede con la importación.

### CA-32.03 — Confirmación de reemplazo de datos

**Dado que** el sistema ha validado el archivo de backup exitosamente,
**cuando** está listo para proceder con la importación,
**entonces** solicita confirmación explícita al ejecutante advirtiendo que todos los datos actuales serán reemplazados por los datos del backup, y que esta operación no es reversible.

### CA-32.04 — Reemplazo completo de datos

**Dado que** el ejecutante confirma la importación,
**cuando** el sistema ejecuta la restauración,
**entonces** reemplaza todos los datos actuales (perfil, historial de peso, sesiones, registros de series, estado de rotación, estados de progresión, conteo de microciclos y configuraciones) con los datos del archivo de backup.

### CA-32.05 — Migración de versiones

**Dado que** el archivo de backup fue generado con una versión anterior del esquema de datos,
**cuando** el sistema detecta que los metadatos de versión no coinciden con la versión actual,
**entonces** aplica las migraciones necesarias para adaptar los datos a la versión actual del esquema, sin pérdida de información.

### CA-32.06 — Rendimiento de la importación

**Dado que** el ejecutante ejecuta la importación de respaldo,
**cuando** el sistema procesa la restauración,
**entonces** el proceso completo se ejecuta en menos de 10 segundos para un historial de hasta 2 años de datos.

### CA-32.07 — Indicación de progreso y confirmación

**Dado que** el ejecutante inicia la importación,
**cuando** el sistema procesa la restauración,
**entonces** muestra una indicación de progreso durante el proceso y una confirmación clara al completarse exitosamente, indicando que los datos han sido restaurados.

### CA-32.08 — Rollback ante error

**Dado que** el sistema está ejecutando la importación,
**cuando** ocurre un error durante el proceso (archivo corrupto parcialmente, fallo de escritura),
**entonces** el sistema revierte la operación y mantiene los datos anteriores intactos, informando al ejecutante que la importación falló y sus datos originales están preservados.
