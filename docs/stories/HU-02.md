# HU-02 ‚Äî Consultar historial de peso corporal

## Requisitos relacionados

RF03

## Descripci√≥n

Como ejecutante, quiero consultar el historial de cambios de mi peso corporal con la fecha de cada actualizaci√≥n, para poder visualizar mi evoluci√≥n de peso en el tiempo y correlacionarla con mi progresi√≥n de entrenamiento.

## Criterios de Aceptaci√≥n

### CA-02.01 ‚Äî Registro autom√°tico en el historial al actualizar peso

**Dado que** el ejecutante actualiza su peso corporal en el perfil,
**cuando** la actualizaci√≥n se persiste exitosamente,
**entonces** el sistema almacena autom√°ticamente una entrada en el historial de peso con el nuevo valor en kilogramos y la fecha de la actualizaci√≥n, sin requerir acci√≥n adicional del ejecutante.

### CA-02.02 ‚Äî Consulta del historial de peso

**Dado que** el ejecutante tiene al menos una entrada en el historial de peso corporal,
**cuando** accede a la consulta de historial de peso,
**entonces** el sistema muestra todas las entradas registradas, cada una con la fecha de actualizaci√≥n y el peso en Kg, ordenadas cronol√≥gicamente de la m√°s reciente a la m√°s antigua.

### CA-02.03 ‚Äî Visualizaci√≥n de la evoluci√≥n temporal

**Dado que** el ejecutante tiene m√∫ltiples entradas en el historial de peso,
**cuando** consulta el historial,
**entonces** el sistema presenta la informaci√≥n de manera que permita identificar la tendencia del peso a lo largo del tiempo (ascendente, descendente o estable).

### CA-02.04 ‚Äî Historial vac√≠o

**Dado que** el ejecutante no ha actualizado su peso corporal desde el registro inicial del perfil,
**cuando** accede a la consulta de historial de peso,
**entonces** el sistema muestra el peso del registro inicial como √∫nica entrada, con la fecha en que se cre√≥ el perfil.

### CA-02.05 ‚Äî Conservaci√≥n de todas las entradas

**Dado que** el ejecutante ha actualizado su peso m√∫ltiples veces,
**cuando** consulta el historial,
**entonces** el sistema muestra todas las entradas hist√≥ricas sin excepci√≥n; ninguna entrada se elimina ni se sobrescribe al registrar una nueva actualizaci√≥n.

---

## An√°lisis Arquitect√≥nico

> HU-02 es la segunda historia en implementarse. La infraestructura base, la capa de datos de peso y la navegaci√≥n C1‚ÜíC2 ya existen gracias a HU-01. Esta historia reemplaza el stub de C2 con la pantalla funcional completa.

### Patr√≥n arquitect√≥nico

MVVM con capa Domain expl√≠cita (4 capas: UI ‚Üí ViewModel ‚Üí Domain ‚Üí Data), seg√∫n ADR-05. Mismo patr√≥n establecido en HU-01.

### Componentes afectados

#### 1. Domain Layer ‚Äî Use Case (Nuevo)

- **`GetWeightHistoryUseCase`**: Use Case en Kotlin puro. Invoca `ProfileRepository.getAllWeightRecords()` que retorna `Flow<List<WeightRecord>>` ordenado descendente por fecha. No requiere validaci√≥n ‚Äî es lectura pura. La lista siempre tiene al menos 1 entrada (el registro inicial creado junto al perfil en HU-01). Paquete: `domain.usecase.profile`.

#### 2. UI Layer ‚Äî WeightHistoryViewModel (Nuevo)

Paquete: `ui.profile`.

- **`WeightHistoryViewModel`**: `@HiltViewModel`. Inyecta `GetWeightHistoryUseCase`. En `init`, recolecta el `Flow<List<WeightRecord>>` y lo transforma a `StateFlow<WeightHistoryUiState>`. La transformaci√≥n determina cu√°l es la entrada m√°s antigua de la lista (√∫ltima posici√≥n, ya que la lista viene ordenada DESC) y la marca como "Registro inicial" (CA-02.04, Modelo de Datos ¬ß3.9: `MIN(date)`).

#### 3. UI Layer ‚Äî WeightHistoryUiState (Nuevo)

Paquete: `ui.profile`.

- **`WeightHistoryUiState`**: Data class con `isLoading: Boolean` y `weightEntries: List<WeightEntryItem>`.
- **`WeightEntryItem`**: Data class con `weightKg: Double`, `date: LocalDate`, `isInitialRecord: Boolean`. El flag `isInitialRecord` se calcula en el ViewModel comparando la fecha de cada registro contra la fecha m√°s antigua de la lista. Solo la entrada con la fecha m√°s antigua tiene `isInitialRecord = true`.

#### 4. UI Layer ‚Äî WeightHistoryScreen (Modificaci√≥n ‚Äî Reemplazar stub)

Paquete: `ui.profile`.

Reemplaza el stub actual (Box con texto centrado) con la pantalla funcional completa seg√∫n Wireframes C2 y Especificaci√≥n Visual ¬ß8 C2.

- **Top Bar**: `TensionTopAppBar` con `‚Üê` retorno + t√≠tulo "Historial de Peso". Ya existe en el stub.
- **Body**: `LazyColumn` scrollable con las entradas de peso. Cada fila es un `ListItem` M3 de 56 dp:
  - `headlineContent`: fecha en formato "dd MMM yyyy" (ej: "10 feb 2026"), alineada izquierda, `Body Medium`, `On Surface`.
  - `trailingContent`: peso con sufijo "Kg" (ej: "78.5 Kg"), `Body Medium`, `On Surface`, `fontWeight = Medium`.
  - Si `isInitialRecord == true`: **dentro del `ListItem`** se muestra como `supportingContent` un `Text` con "Registro inicial" en `Body Small`, `On Surface Variant`, `paddingTop = 2.dp` (Especificaci√≥n Visual ¬ß8 C2: *"Padding top: 2 dp bajo el peso"*, ¬ß7.7: *"Etiqueta 'Registro inicial' como Body Small si aplica"*). La etiqueta es parte de la fila, no un elemento separado debajo.
  - `Divider` M3 entre filas: 1 dp, `Outline Variant`, full width.
- **Bottom Navigation**: `BottomNavigationBar` con Configuraci√≥n activo. C2 se muestra dentro del Scaffold del `TensionNavHost` donde la Bottom Nav ya es visible. **Requiere ajuste en la l√≥gica de selecci√≥n del `BottomNavigationBar`**: actualmente determina el √≠tem activo por `currentRoute == item.route`, pero cuando la ruta es `weight-history` (o `profile`) ninguno de los 5 √≠tems coincide. Se debe ampliar la condici√≥n de selecci√≥n del √≠tem Configuraci√≥n para incluir las rutas hijas del flujo perfil: `currentRoute in setOf("settings", "profile", "weight-history")`. Esto aplica seg√∫n Especificaci√≥n Visual ¬ß8 C2 y Wireframes C2: *"Configuraci√≥n marcado como activo"*.
- **Estado vac√≠o**: No aplica formalmente ‚Äî siempre hay al menos 1 entrada (el registro inicial del perfil, CA-02.04). No obstante, se mantiene un guard defensivo en el composable por si la lista est√° cargando.

**Firma actualizada del composable:**

```kotlin
@Composable
fun WeightHistoryScreen(
    onNavigateBack: () -> Unit,
    viewModel: WeightHistoryViewModel = hiltViewModel(),
)
```

#### 5. UI Layer ‚Äî BottomNavigationBar (Modificaci√≥n menor)

Paquete: `ui.components`.

- **`BottomNavigationBar`**: Extender la l√≥gica de selecci√≥n del √≠tem activo. Actualmente `selected = currentRoute == item.route`. Para el √≠tem Configuraci√≥n, debe ser `selected = currentRoute in setOf("settings", "profile", "weight-history")`. Esto hace que Configuraci√≥n se muestre activo cuando el ejecutante est√° en C1 o C2, que son pantallas hijas del flujo perfil accesible desde J1. Sin esta correcci√≥n, ning√∫n √≠tem del Bottom Nav se marca como activo en C1 ni C2, contradiciendo la Especificaci√≥n Visual ¬ß8 C1 y C2.

#### 6. Recursos (Modificaci√≥n)

- **`strings.xml`**: Agregar `weight_history_initial_record` = "Registro inicial". Agregar `weight_history_kg_suffix` = "Kg" (sufijo de peso, se compone en c√≥digo como `"$value Kg"`). El string `weight_history_empty` existente se conserva como fallback defensivo.

### Integraciones

| Interfaz / Contrato | Productor | Consumidor | Descripci√≥n |
| --- | --- | --- | --- |
| `ProfileRepository.getAllWeightRecords()` | `ProfileRepositoryImpl` (existente) | `GetWeightHistoryUseCase` | Retorna `Flow<List<WeightRecord>>` ordenado DESC por fecha. Ya implementado en HU-01 |
| `StateFlow<WeightHistoryUiState>` | `WeightHistoryViewModel` | `WeightHistoryScreen` | Estado reactivo con lista de entradas de peso + flag de registro inicial |

### Riesgos

| Riesgo | Probabilidad | Impacto | Mitigaci√≥n |
| --- | --- | --- | --- |
| Formato de fecha `LocalDate` ‚Üí "dd MMM yyyy" en espa√±ol puede variar seg√∫n locale del dispositivo | Baja | Bajo | Usar `DateTimeFormatter` con `Locale("es")` expl√≠cito para garantizar formato consistente (RNF08: UI en espa√±ol) |
| Bottom Navigation no marca Configuraci√≥n como activo en C2 | Certeza | Bajo | Extender l√≥gica de selecci√≥n del `BottomNavigationBar` para incluir rutas hijas del flujo perfil (`profile`, `weight-history`) como asociadas al √≠tem Configuraci√≥n |

### Hitos de implementaci√≥n

| Hito | Contenido | Dependencias |
| --- | --- | --- |
| 1 | Domain: `GetWeightHistoryUseCase` | ‚Äî (Kotlin puro, usa interfaz existente) |
| 2 | UI: `WeightHistoryUiState`, `WeightHistoryViewModel` | Hito 1 |
| 3 | UI: Reemplazar stub de `WeightHistoryScreen` con lista funcional + strings | Hito 2 |
| 4 | UI: Ajustar `BottomNavigationBar` para marcar Configuraci√≥n activo en rutas hijas del flujo perfil | ‚Äî (independiente) |

### Notas de auditor√≠a

1. **CA-02.01 ya est√° cubierto por HU-01.** El `ProfileViewModel` en C1 ya invoca `UpdateWeightUseCase` cuando el peso cambia, que a su vez inserta un nuevo `WeightRecordEntity` sin borrar anteriores. No se requiere trabajo adicional para este CA.
2. **CA-02.03 (tendencia temporal) se cumple mediante la lista cronol√≥gica ordenada.** Ni el wireframe C2 ni la Especificaci√≥n Visual ¬ß8 C2 definen un componente gr√°fico de tendencia. La presentaci√≥n descendente por fecha con pesos visibles permite al ejecutante identificar la tendencia visualmente (ascendente, descendente o estable) leyendo los valores secuenciales.
3. **CA-02.05 (conservaci√≥n) ya est√° garantizado por dise√±o.** `updateWeight()` en `ProfileRepositoryImpl` hace `INSERT`, nunca `UPDATE` ni `DELETE`. La tabla `weight_record` es append-only.
4. **"Registro inicial" se identifica por `MIN(date)`** (Modelo de Datos ¬ß3.9), no por flag. En la lista DESC, es el √∫ltimo elemento. El ViewModel lo calcula comparando contra el √∫ltimo √≠tem de la lista ordenada.
5. **No se requieren cambios en Data Layer ni DI.** `WeightRecordDao.getAllDescByDate()`, `ProfileRepository.getAllWeightRecords()` y `ProfileRepositoryImpl.getAllWeightRecords()` ya existen. El `DatabaseModule` ya provee `WeightRecordDao`. No hay nuevas entidades, DAOs ni m√≥dulos Hilt.
6. **El NavHost no requiere cambios estructurales.** La ruta `weight-history` ya existe y ya inyecta `WeightHistoryScreen` con el callback `onNavigateBack`. Solo cambia la implementaci√≥n interna del composable para aceptar el ViewModel.
7. **Formato de fecha**: Seg√∫n wireframe C2 el formato es "dd mmm yyyy" (ej: "10 feb 2026"). Se usa `DateTimeFormatter.ofPattern("dd MMM yyyy", Locale("es"))` para garantizar espa√±ol en cumplimiento de RNF08 (*"Toda la interfaz de usuario debe estar en idioma espa√±ol"*), independientemente del locale del dispositivo.
8. **`BottomNavigationBar` requiere ajuste de selecci√≥n** para que Configuraci√≥n se marque como activo cuando la ruta actual es `profile` o `weight-history`. Esto no es un cambio estructural sino una extensi√≥n de la l√≥gica de `selected` existente.
9. **Compatibilidad con HU-31/HU-32 (Backup/Restore) verificada.** Ambas historias listan "historial de peso" como dato incluido en backup/restore, confirmando que el dise√±o append-only de `weight_record` es correcto.

---

## Refinamiento T√©cnico (Developer)

<!-- SECCI√ìN AGREGADA POR: Workflow refinamiento-tecnico -->
<!-- ETAPA: Refinamiento T√©cnico -->
<!-- RESPONSABLE: Developer -->
<!-- BASE: An√°lisis Arquitect√≥nico (Arquitecto) - Ver secci√≥n arriba -->
<!-- FECHA: 2026-02-12 -->
<!-- ESTADO: Terminado -->
<!-- AUDITOR√çA: Completada 2026-02-12 ‚Äî Cruce exhaustivo contra toda la documentaci√≥n y c√≥digo HU-01 implementado. Sin issues pendientes. -->
<!-- DESARROLLO: Completado 2026-02-12 ‚Äî 21 unit tests pasando (18 HU-01 + 3 HU-02). Build exitoso. -->

### Consideraciones Generales

**Basado en an√°lisis arquitect√≥nico:**
An√°lisis Arquitect√≥nico de HU-02 con 4 hitos, 6 componentes, 2 integraciones y 2 riesgos identificados. Patr√≥n MVVM con capa Domain expl√≠cita (ADR-05). Segunda historia ‚Äî toda la infraestructura base ya existe gracias a HU-01.

**Nivel de complejidad:**
BAJA ‚Äî Esta historia reemplaza un stub existente (`WeightHistoryScreen`) con una lista de solo lectura. No crea entidades, DAOs, repositorios ni m√≥dulos Hilt nuevos. El volumen de c√≥digo nuevo es m√≠nimo: 1 Use Case, 1 ViewModel, 1 UiState, reescritura de 1 Screen y ajuste menor en 1 componente reutilizable.

**Riesgos t√©cnicos conocidos:**

1. Formato de fecha `LocalDate` ‚Üí "dd MMM yyyy" en espa√±ol puede variar seg√∫n locale del dispositivo ‚Äî usar `DateTimeFormatter` con `Locale("es")` expl√≠cito (RNF08).
2. Bottom Navigation no marca Configuraci√≥n como activo en C1 ni C2 ‚Äî extender l√≥gica de selecci√≥n del `BottomNavigationBar`.

**Patrones y convenciones del equipo (establecidos en HU-01):**

- C√≥digo fuente en ingl√©s, UI y datos de dominio en espa√±ol (Arquitectura T√©cnica ¬ß5.1)
- Naming: `{Feature}Screen`, `{Feature}ViewModel`, `{Acci√≥n}{Entidad}UseCase` (¬ß5.2)
- Estructura Composable: `hiltViewModel()` + `collectAsStateWithLifecycle()` + `LaunchedEffect` para eventos (¬ß5.3)
- Estructura ViewModel: `_uiState MutableStateFlow` / `uiState StateFlow` (¬ß5.4)
- `operator fun invoke()` en Use Cases
- Callbacks en Composables con prefijo `on` (`onNavigateBack`)

**Dependencias nuevas a instalar:**
Ninguna. Todas las dependencias necesarias ya est√°n configuradas en HU-01.

**Estrategia de testing:**
JUnit 4 (ADR-18) + MockK + kotlinx-coroutines-test | Test unitario para `GetWeightHistoryUseCase` (domain) | Cobertura: 100% Use Case

### Historias Relacionadas Consultadas

**Implementaciones similares analizadas:**
HU-01 ‚Äî Se reutiliza exactamente el mismo patr√≥n ViewModel + StateFlow + Screen establecido en `ProfileViewModel`/`ProfileScreen`. `GetProfileUseCase` sirve como referencia directa para `GetWeightHistoryUseCase`.

**Patrones de c√≥digo reutilizados:**

- Patr√≥n `Flow<List<T>>` ‚Üí `StateFlow<UiState>` del ViewModel (igual que `ProfileViewModel.loadProfile()`)
- `TensionTopAppBar` con variante retorno (ya usado en `ProfileScreen`, `WeightHistoryScreen` stub)
- `BottomNavigationBar` ya montado en el `Scaffold` de `TensionNavHost` ‚Äî no se re-monta dentro del Screen

**Mejores pr√°cticas aplicadas:**

- La lista siempre tiene ‚â•1 entrada (registro inicial del onboarding) ‚Äî no hay estado vac√≠o real
- "Registro inicial" se identifica por ser el √∫ltimo √≠tem de la lista DESC (`MIN(date)`), sin flag en BD
- Guard defensivo para estado de carga mientras el Flow emite su primer valor
- Formato de fecha con `Locale("es")` expl√≠cito para independencia del locale del dispositivo

### C√≥digo existente verificado (HU-01 ya implementado)

| Componente | Archivo | Estado |
| --- | --- | --- |
| `WeightRecord` (domain model) | `domain/model/WeightRecord.kt` | ‚úÖ Existe ‚Äî `data class WeightRecord(id: Long, weightKg: Double, date: LocalDate)` |
| `ProfileRepository.getAllWeightRecords()` | `domain/repository/ProfileRepository.kt` | ‚úÖ Existe ‚Äî `fun getAllWeightRecords(): Flow<List<WeightRecord>>` |
| `ProfileRepositoryImpl.getAllWeightRecords()` | `data/repository/ProfileRepositoryImpl.kt` | ‚úÖ Existe ‚Äî mapea `WeightRecordEntity` ‚Üí `WeightRecord`, ordena DESC por fecha |
| `WeightRecordDao.getAllDescByDate()` | `data/local/dao/WeightRecordDao.kt` | ‚úÖ Existe ‚Äî `@Query("SELECT * FROM weight_record ORDER BY date DESC")` |
| `WeightHistoryScreen` (stub) | `ui/profile/WeightHistoryScreen.kt` | ‚úÖ Existe como stub ‚Äî Box con texto centrado, se reemplazar√° |
| Ruta `weight-history` en NavHost | `ui/navigation/TensionNavHost.kt` | ‚úÖ Existe ‚Äî `composable(NavigationRoutes.WEIGHT_HISTORY) { WeightHistoryScreen(...) }` |
| `BottomNavigationBar` | `ui/components/BottomNavigationBar.kt` | ‚úÖ Existe ‚Äî requiere ajuste en l√≥gica de `selected` para rutas hijas |
| `strings.xml` ‚Äî strings de C2 | `res/values/strings.xml` | ‚úÖ Parcial ‚Äî existen `weight_history_title` y `weight_history_empty`, faltan `weight_history_initial_record` y `weight_history_kg_suffix` |
| `DatabaseModule` / `RepositoryModule` | `di/` | ‚úÖ Existe ‚Äî no requiere cambios |

---

## Tareas de Implementaci√≥n (Developer)

### Fase 1: Domain Layer ‚Äî Use Case

> Basado en Hito #1 del An√°lisis Arquitect√≥nico

#### üì¶ Use Case

- [ ] **Crear GetWeightHistoryUseCase** (AC: 02.02, 02.04, 02.05)
  - [ ] Clase en Kotlin puro. Inyecta `ProfileRepository`. `operator fun invoke(): Flow<List<WeightRecord>>`. Delega directamente a `profileRepository.getAllWeightRecords()` ‚Äî es lectura pura sin l√≥gica adicional. La lista retorna ‚â•1 entrada (registro inicial siempre existe), ordenada DESC por fecha ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/domain/usecase/profile/GetWeightHistoryUseCase.kt`
  - [ ] Test unitario: verifica que invoca `profileRepository.getAllWeightRecords()` y retorna el Flow sin transformaci√≥n. Caso con m√∫ltiples registros, caso con solo registro inicial (1 entrada) ‚Äî Archivo: `app/src/test/java/com/estebancoloradogonzalez/tension/domain/usecase/profile/GetWeightHistoryUseCaseTest.kt`

### Fase 2: UI Layer ‚Äî UiState y ViewModel

> Basado en Hito #2 del An√°lisis Arquitect√≥nico

#### üì¶ UiState

- [ ] **Crear WeightHistoryUiState y WeightEntryItem** (AC: 02.02, 02.04)
  - [ ] `WeightHistoryUiState`: data class con `isLoading: Boolean = true` y `weightEntries: List<WeightEntryItem> = emptyList()`. `WeightEntryItem`: data class con `weightKg: Double`, `date: LocalDate`, `isInitialRecord: Boolean`. El flag `isInitialRecord` se calcula en el ViewModel ‚Äî solo es `true` para la entrada con la fecha m√°s antigua de la lista ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/ui/profile/WeightHistoryUiState.kt`

#### üì¶ ViewModel

- [ ] **Crear WeightHistoryViewModel** (AC: 02.02, 02.03, 02.04, 02.05)
  - [ ] `@HiltViewModel`. Inyecta `GetWeightHistoryUseCase`. En `init`, recolecta el `Flow<List<WeightRecord>>` via `viewModelScope.launch` y lo transforma a `WeightHistoryUiState`: para cada `WeightRecord`, crea `WeightEntryItem` con `isInitialRecord = (record == list.last())` (√∫ltimo de la lista DESC = m√°s antiguo = registro inicial). Expone `val uiState: StateFlow<WeightHistoryUiState>`. Estado inicial: `isLoading = true` ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/ui/profile/WeightHistoryViewModel.kt`

### Fase 3: UI Layer ‚Äî Reemplazar stub de WeightHistoryScreen

> Basado en Hito #3 del An√°lisis Arquitect√≥nico

#### üì¶ Screen

- [ ] **Reemplazar WeightHistoryScreen stub con pantalla funcional** (AC: 02.02, 02.03, 02.04, 02.05)
  - [ ] Reescribir el composable `WeightHistoryScreen`. Firma: `fun WeightHistoryScreen(onNavigateBack: () -> Unit, viewModel: WeightHistoryViewModel = hiltViewModel())`. Recolecta `uiState` con `collectAsStateWithLifecycle()`. Top Bar: `TensionTopAppBar` con retorno + "Historial de Peso" (ya existe en el stub, se conserva). Body: si `isLoading` ‚Üí indicador de carga centrado; si no ‚Üí `LazyColumn` con las entradas. Cada fila usa `ListItem` M3 de 56 dp m√≠nimo: `headlineContent` = fecha formateada "dd MMM yyyy" con `Locale("es")` en `Body Medium`, `On Surface`; `trailingContent` = peso con sufijo "Kg" (ej: "78.5 Kg") en `Body Medium`, `On Surface`, `fontWeight = Medium`; si `isInitialRecord` ‚Üí `supportingContent` con `Text("Registro inicial")` en `Body Small`, `On Surface Variant`, con `Modifier.padding(top = 2.dp)` (Especificaci√≥n Visual ¬ß8 C2: *"Padding top: 2 dp bajo el peso"*). `HorizontalDivider` M3 entre filas: 1 dp, `Outline Variant`. Sin Bottom Navigation dentro del Screen (ya est√° en el Scaffold del NavHost). Guard defensivo: si la lista est√° vac√≠a (te√≥ricamente imposible), mostrar texto `weight_history_empty` existente ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/ui/profile/WeightHistoryScreen.kt`

### Fase 4: UI Layer ‚Äî Ajustar BottomNavigationBar + Strings + NavHost

> Basado en Hito #4 del An√°lisis Arquitect√≥nico

#### üì¶ BottomNavigationBar

- [ ] **Extender l√≥gica de selecci√≥n del √≠tem activo** (AC: 02.02)
  - [ ] En `BottomNavigationBar.kt`, cambiar `val selected = currentRoute == item.route` por una l√≥gica que agrupe rutas hijas: para el √≠tem Configuraci√≥n (`settings`), marcar como activo cuando `currentRoute` est√© en `setOf("settings", "profile", "weight-history")`. Los dem√°s √≠tems mantienen `currentRoute == item.route`. Esto hace que Configuraci√≥n se muestre activo al estar en C1 o C2, conforme a Especificaci√≥n Visual ¬ß8 C1 (*"Configuraci√≥n activo"*) y ¬ß8 C2 (*"Configuraci√≥n activo"*). Implementar con un map de `route ‚Üí Set<String>` o una funci√≥n `isRouteSelected(itemRoute, currentRoute)` para que sea extensible cuando futuras HUs a√±adan rutas hijas a otros tabs ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/ui/components/BottomNavigationBar.kt`

#### üì¶ NavHost

- [ ] **Actualizar composable del NavHost para inyectar ViewModel al WeightHistoryScreen** (AC: 02.02)
  - [ ] En `TensionNavHost.kt`, NO se requiere cambio estructural. La ruta `weight-history` ya existe y monta `WeightHistoryScreen(onNavigateBack = ...)`. Dado que el ViewModel se obtiene via `hiltViewModel()` dentro del composable, la inyecci√≥n es autom√°tica. **Verificar** que la firma del `WeightHistoryScreen` actual (`onNavigateBack: () -> Unit`) sigue siendo compatible ‚Äî si se agrega `viewModel` con default `hiltViewModel()`, la call-site no necesita cambios ‚Äî Archivo: `app/src/main/java/com/estebancoloradogonzalez/tension/ui/navigation/TensionNavHost.kt`

#### üì¶ Recursos

- [ ] **Agregar strings faltantes a strings.xml** (AC: 02.02, 02.04)
  - [ ] Agregar `weight_history_initial_record` = "Registro inicial" y `weight_history_kg_suffix` = "Kg". Los strings `weight_history_title` y `weight_history_empty` ya existen y se conservan ‚Äî Archivo: `app/src/main/res/values/strings.xml`

### Fase 5: QA y Deployment

#### üì¶ Code Quality

- [ ] **Ejecutar Agente Peer Review** ‚Äî MANUAL
- [ ] **Resolver incidentes del Peer Review** (condicional) ‚Äî MANUAL

#### üì¶ Deployment DEV

- [ ] **Crear Pull Request** ‚Äî MANUAL
- [ ] **Ejecutar pipeline deployment DEV** ‚Äî MANUAL

#### üì¶ Testing Manual

- [ ] **Dise√±ar set de pruebas manuales** ‚Äî MANUAL
- [ ] **Ejecutar pruebas manuales** ‚Äî MANUAL

---

**Notas sobre vinculaci√≥n con Criterios de Aceptaci√≥n:**

- CA-02.01 ‚Üí Ya cubierto por HU-01 (`ProfileViewModel.onSaveClick()` invoca `UpdateWeightUseCase` que inserta en `weight_record`). No requiere trabajo en HU-02.
- CA-02.02 ‚Üí Fases 1, 2, 3 (Use Case + ViewModel + Screen con lista DESC)
- CA-02.03 ‚Üí Fase 3 (lista cronol√≥gica descendente permite identificar tendencia visualmente)
- CA-02.04 ‚Üí Fases 2, 3 (flag `isInitialRecord` calculado en ViewModel, etiqueta "Registro inicial" en Screen)
- CA-02.05 ‚Üí Ya garantizado por dise√±o (`weight_record` es append-only, `INSERT` sin `UPDATE`/`DELETE`). No requiere trabajo adicional.
