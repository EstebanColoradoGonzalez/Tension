# HU-09 — Cerrar sesión y avanzar rotación

## Requisitos relacionados

RF18, RF19, RF20, RF21, RNF10

## Descripción

Como ejecutante, quiero poder cerrar mi sesión de entrenamiento como Completada o Incompleta, que el sistema calcule automáticamente el tonelaje y avance la rotación cíclica, para que mis datos queden consolidados, la posición del plan se actualice correctamente y yo pueda continuar con confianza en la próxima sesión.

## Criterios de Aceptación

### CA-09.01 — Cierre como Completada

**Dado que** el ejecutante tiene una sesión activa y todas las series de todos los ejercicios de la sesión han sido registradas (todos los ejercicios en estado "Completado" con 4 series cada uno),
**cuando** selecciona la opción de cerrar sesión,
**entonces** el sistema cierra la sesión con estado "Completada" y la marca como inmutable.

### CA-09.02 — Cierre como Incompleta

**Dado que** el ejecutante tiene una sesión activa pero no ha completado todas las series de todos los ejercicios,
**cuando** selecciona la opción de cerrar sesión anticipadamente,
**entonces** el sistema cierra la sesión con estado "Incompleta", conservando todos los datos parciales registrados hasta ese momento sin descartar ninguna serie.

### CA-09.03 — Confirmación antes de cierre incompleto

**Dado que** el ejecutante tiene una sesión activa con ejercicios sin completar,
**cuando** intenta cerrar la sesión,
**entonces** el sistema solicita confirmación indicando que la sesión se cerrará como "Incompleta" y mostrando cuántos ejercicios quedaron sin completar, antes de ejecutar el cierre.

### CA-09.04 — Cálculo automático de tonelaje al cerrar

**Dado que** el ejecutante cierra una sesión (ya sea Completada o Incompleta),
**cuando** el sistema procesa el cierre,
**entonces** calcula automáticamente el tonelaje total de la sesión sumando el producto de Peso × Repeticiones de todas las series registradas en la sesión, y almacena el resultado como dato derivado de la sesión.

### CA-09.05 — Avance de la rotación cíclica al cerrar

**Dado que** el ejecutante cierra una sesión (ya sea Completada o Incompleta),
**cuando** el sistema procesa el cierre,
**entonces** avanza la posición en la rotación cíclica de módulos al siguiente módulo (A→B, B→C, C→A) y registra la versión ejecutada para actualizar la secuencia de versiones del módulo.

### CA-09.06 — Avance de rotación solo al cerrar

**Dado que** el ejecutante tiene una sesión activa en progreso,
**cuando** aún no ha cerrado la sesión,
**entonces** la posición en la rotación cíclica y la secuencia de versiones no se modifican; el avance ocurre únicamente en el momento del cierre.

### CA-09.07 — Inmutabilidad de sesiones cerradas

**Dado que** una sesión ha sido cerrada (Completada o Incompleta),
**cuando** el ejecutante consulta esa sesión en el historial,
**entonces** los datos de la sesión son de solo lectura; no se permite editar, eliminar ni agregar series retroactivamente a sesiones cerradas.

### CA-09.08 — Preservación ante cierre inesperado durante el cierre

**Dado que** la aplicación se cierra inesperadamente mientras el sistema procesa el cierre de una sesión (cálculo de tonelaje, avance de rotación),
**cuando** el ejecutante reabre la aplicación,
**entonces** el sistema detecta el estado inconsistente y permite al ejecutante completar el cierre de la sesión o recuperar la sesión activa sin pérdida de datos registrados.
